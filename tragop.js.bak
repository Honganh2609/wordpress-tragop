var devvn_vimo_array = {
    "ajaxurl": "https:\/\/darlingvietnam.net\/wp-admin\/admin-ajax.php",
    "company_list" :{
        "MCredit": {
            "name": "M Credit",
            "month": {
                "3": "0",
                "6": "0",
                "8": "3.16",
                "9": "3.48",
                "12": "4.96"
            },
            "minprice": "1000000",
            "logo": "https:\/\/darlingvietnam.net\/wp-content\/uploads\/m-credit-mb.png"
        }
    },
    "bank_list": {
        "VCB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP Ngo\u1ea1i Th\u01b0\u01a1ng Vi\u1ec7t Nam",
            "month": {
                "3": "2.9",
                "6": "3.9",
                "9": "4.9",
                "12": "6.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "TCB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP K\u1ef9 Th\u01b0\u01a1ng",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "6.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "MB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP Qu\u00e2n \u0110\u1ed9i",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "VIB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP Qu\u1ed1c t\u1ebf",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "2000000",
            "logo": ""
        },
        "EXB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP Xu\u1ea5t Nh\u1eadp Kh\u1ea9u",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "6.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "ACB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP \u00c1 Ch\u00e2u",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "MSB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP H\u00e0ng H\u1ea3i",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "VPB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP Vi\u1ec7t Nam Th\u1ecbnh V\u01b0\u1ee3ng",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "7.9",
                "12": "8.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "STB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP S\u00e0i G\u00f2n Th\u01b0\u01a1ng T\u00edn",
            "month": {
                "3": "",
                "6": "3.9",
                "9": "",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "BIDV": {
            "name": "Ng\u00e2n h\u00e0ng \u0110\u1ea7u t\u01b0 v\u00e0 Ph\u00e1t tri\u1ec3n Vi\u1ec7t Nam",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "SHB": {
            "name": "Ng\u00e2n h\u00e0ng TMCP S\u00e0i G\u00f2n - H\u00e0 N\u1ed9i",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": "8.5"
            },
            "minprice": "3000000",
            "logo": ""
        },
        "SEA": {
            "name": "Ng\u00e2n h\u00e0ng TMCP \u0110\u00f4ng Nam \u00c1",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "TPB": {
            "name": "TienphongBank",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "HSBC": {
            "name": "Ng\u00e2n h\u00e0ng TNHH m\u1ed9t th\u00e0nh vi\u00ean HSBC",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "SHBKV": {
            "name": "Ng\u00e2n h\u00e0ng TNHH MTV Shinhan Vi\u1ec7t Nam",
            "month": {
                "3": "",
                "6": "3.9",
                "9": "4.9",
                "12": "6.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "ANZVN": {
            "name": "Ng\u00e2n h\u00e0ng TNHH m\u1ed9t th\u00e0nh vi\u00ean ANZ (Vi\u1ec7t Nam)",
            "month": {
                "3": "",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "SCBL": {
            "name": "Ng\u00e2n h\u00e0ng TNHH M\u1ed9t th\u00e0nh vi\u00ean Standard Chartered (Vi\u1ec7t Nam)",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "2000000",
            "logo": ""
        },
        "SCB": {
            "name": "Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng M\u1ea1i C\u1ed5 Ph\u1ea7n S\u00e0i G\u00f2n",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "CTB": {
            "name": "Ng\u00e2n h\u00e0ng Citibank Vi\u1ec7t Nam",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "FEC": {
            "name": "FE Credit",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "2000000",
            "logo": ""
        },
        "OCB": {
            "name": "Ng\u00e2n H\u00e0ng TMCP Ph\u01b0\u01a1ng \u0110\u00f4ng Vi\u1ec7t Nam",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "5.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "KLB": {
            "name": "Ng\u00e2n h\u00e0ng Th\u01b0\u01a1ng m\u1ea1i C\u1ed5 ph\u1ea7n Ki\u00ean Long",
            "month": {
                "3": "2",
                "6": "3.9",
                "9": "4.9",
                "12": "6.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        },
        "HOMEC": {
            "name": "Home Credit",
            "month": {
                "3": "",
                "6": "3.9",
                "9": "5.9",
                "12": "6.9",
                "18": ""
            },
            "minprice": "3000000",
            "logo": ""
        }
    },
    "userfee": "1",
    "fee_vimo": "1",
    "currency_format_num_decimals": "0",
    "currency_format_symbol": "\u20ab",
    "currency_format_decimal_sep": ",",
    "currency_format_thousand_sep": ".",
    "currency_format": "%v%s",
    "fee_enable": "1"
};

var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return typeof sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
    return false;
};

function formatCurrency(a) {
    var b = parseFloat(a).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1.").toString();
    var len = b.length;
    b = b.substring(0, len - 3);
    return b;
}

//console.log(devvn_vimo_array);
console.log(devvn_vimo_array.bank_list);

//init
(function($){
    var type = getUrlParameter('type');
    var price = $('#vimo_bank_prod_price').val();
    var pro_id = $('#vimo_bank_prod_id').val();
    var company_list = devvn_vimo_array.company_list;
    var bank_list = devvn_vimo_array.bank_list;
    var phiDongTien = 12000; // phí đóng tiền mỗi tháng
    var goiBaohiem = 0.5; // %

    function CompanyCal() {
        var month = parseInt($('.tragop-month li.active a').attr('data-month'));
        var percent = $('.tragop-tratruoc').val();

        var traTruoc = (price * percent)/100;
        $('.tratruoc-val.home-credit').html(formatCurrency(traTruoc) + '₫' + ' ('+percent+'%)');

        var tiengocConlai = price - traTruoc;
        $('.home-tiengoc.tiengoc-conlai').html(formatCurrency(tiengocConlai) + '₫');

        var mCredit = company_list.MCredit.month;
        var phantramLaicaNam = mCredit[month];

        //
        var tienLaiTotal = tiengocConlai + (price * phantramLaicaNam)/100 + phiDongTien*month +(price * goiBaohiem)/100;
        $('.home-total').html(formatCurrency(traTruoc+tienLaiTotal) + '₫');

        var monthly = tienLaiTotal / month;
        $('.home-month.home-credit').html(formatCurrency(monthly) + '₫');

        var Total = traTruoc + tienLaiTotal;
        $('.home-chenhlech').html(formatCurrency(Total - price) + '₫');

        //console.log(mCredit[month]);

        $('#bank_tratruoc').val(formatCurrency(traTruoc)  + '₫' + ' ('+percent+'%)');
        $('#bank_month').val(month);
        $('#bank_thuho').val(formatCurrency(phiDongTien));
        $('#bank_baohiem').val(goiBaohiem + "%");
        $('#bank_total').val(formatCurrency(Total));
        $('#bank_name').val('MCredit');
        $('#bank_chenhlech').val(formatCurrency(Total - price));
        $('#bank_tramoithang').val(formatCurrency(monthly));

    }

    function BankCal() {
        var vimo_bank = $('input[name=vimo_bank]:checked').val(); // loại bank
        var vimo_prepaid = $('input[name=vimo_prepaid]:checked').val(); // % trả trước
        var traTruoc = $('input[name=vimo_prepaid]:checked').data( "price"); // số tiền trả trước
        var vimo_cycle = $('input[name=vimo_cycle]:checked').val(); // tháng

        var getBankinfo = bank_list[vimo_bank]; 
        var phantramLaicaNam = getBankinfo.month[vimo_cycle]; console.log(phantramLaicaNam);
        var tiengocConlai = price - traTruoc;
        var tienLaiTotal = tiengocConlai + (tiengocConlai * phantramLaicaNam)/100 + phiDongTien*vimo_cycle +(price * goiBaohiem)/100;
        var Total = traTruoc + tienLaiTotal;
        $('.total_vimo').html(formatCurrency(traTruoc+tienLaiTotal) + '₫');
        var monthly = tienLaiTotal / vimo_cycle;
        $('.total_month').html(formatCurrency(monthly) + '₫');
        $('.devvn_installment_alepay .total_pay').html(formatCurrency(traTruoc) + '₫' + ' ('+vimo_prepaid+'%)');
        $('.chenhlech_vimo').html(formatCurrency(Total - price));

        $('#vimo_tratruoc').val(formatCurrency(traTruoc)  + '₫' + ' ('+vimo_prepaid+'%)');
        $('#vimo_month').val(vimo_cycle);
        $('#vimo_thuho').val(formatCurrency(phiDongTien));
        $('#vimo_baohiem').val(goiBaohiem + "%");
        $('#vimo_total').val(formatCurrency(Total));
        $('#vimo_name').val(vimo_bank);
        $('#vimo_chenhlech').val(formatCurrency(Total - price));
        $('#vimo_tramoithang').val(formatCurrency(monthly));
    }

    //
    $(document).ready(function () {
        //add button to detail
        var proid = $('button[name=add-to-cart]').val();
        var link = '';
        var string = `<div class="devvn_tragop_btn">
        <a rel="nofollow" class="devvn_vimo_button" href="/tra-gop/?pro=`+ proid +`&type=bank"><span>MUA TRẢ GÓP 0%</span><small>Duyệt hồ sơ tại cửa hàng</small></a>
        <a rel="nofollow" class="devvn_vimo_button" href="/tra-gop/?pro=`+ proid +`&type=vimo"><span>TRẢ GÓP QUA THẺ</span><small>Visa, Master, JCB</small></a>
        </div>`;
        $('.cart').append(string);

        //
        if (type == 'bank') {$('#choose_type li.type-bank').click();}
        if (type == 'vimo') {$('#choose_type li.type-vimo').click();BankCal();}

        $('.tragop-month li:nth-child(2)').click();
        $( ".tragop-tratruoc" ).change(function() {
            CompanyCal();
        });

    });  

    $('#choose_type li').on('click', function(){
        $(this).find('.type').toggleClass('active');
        var type = $(this).find('input[name=type]').val(); //console.log(type);
        $(this).find('input[name=type]').attr( 'checked', true );
        if (type == 'vimo') {$('.devvn_tragop_main').addClass('vimo').removeClass('bank');}
        if (type == 'bank') {
            $('.devvn_tragop_main').addClass('bank').removeClass('vimo');
            BankCal();
        }
    });

    $('.bank-dangky').on('click', function(){
        $('.bank_infor_customer').toggle();
    });

    $('.tragop-month li').on('click', function(){
        $('.tragop-month li').removeClass('active');
        $(this).addClass('active');
        CompanyCal();
    });

    $('.vimo_listbank label').on('click', function(){BankCal();});
    $('.vimo_prepaid_wrap label').on('click', function(){BankCal();});
    $('.vimo_cycle_wrap label').on('click', function(){BankCal();});


})(jQuery);
